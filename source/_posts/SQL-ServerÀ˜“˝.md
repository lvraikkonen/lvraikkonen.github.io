---
title: SQL Server索引
tags:
  - SQL Server
date: 2017-06-02 16:04:35
---

索引是与表或视图关联的磁盘上结构，可以加快从表或视图中检索行的速度。在SQL Server中，索引和表（这里指的是加了聚集索引的表）的存储结构是一样的,都是B树，B树是一种用于查找的平衡多叉树。

## 索引的利弊

查询执行的大部分开销是I/O，使用索引提高性能的一个主要目标是避免全表扫描，因为全表扫描需要从磁盘上读取表的每一个数据页，如果有索引指向数据值，则查询只需要读少数次的磁盘就行啦。所以合理的使用索引能加速数据的查询。但是索引并不总是提高系统的性能，带索引的表需要在数据库中占用更多的存储空间，同样用来增删数据的命令运行时间以及维护索引所需的处理时间会更长。所以我们要合理使用索引，及时更新去除次优索引。

## 数据表的基本结构

一个新表被创建之时，系统将在磁盘中分配一段以8K为单位的连续空间，当字段的值从内存写入磁盘时，就在这一既定空间随机保存，当一个 8K用完的时候，数据库指针会自动分配一个8K的空间。这里，每个8K空间被称为一个数据页（Page），又名页面或数据页面，并分配从0-7的页号, 每个文件的第0页记录引导信息，叫文件头（File header）；每8个数据页（64Ｋ）的组合形成扩展区（Extent），称为扩展。全部数据页的组合形成堆（Heap）


## 聚集索引和非聚集索引

在SQL SERVER中，聚集索引的存储是以B树存储，B树的叶子直接存储聚集索引的数据

![ClusteredIndex](https://i-technet.sec.s-msft.com/dynimg/IC144198.gif)

非聚集索引与聚集索引具有相同的 B 树结构，它们之间的显著差别在于以下两点：
- 基础表的数据行不按非聚集键的顺序排序和存储。
- 非聚集索引的叶层是由索引页而不是由数据页组成。

![NonClusteredIndex](https://i-technet.sec.s-msft.com/dynimg/IC85533.gif)

非聚集索引也是一个B树结构，与聚集索引不同的是，B树的叶子节点存的是指向堆或聚集索引的指针。

## 索引的设计原则
